<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>_dl_runtime_resolve Research &#8211; Ever R In The Sun</title>
<meta name="description" content="Dying in the sun">
<meta name="keywords" content="exploit, _dl_runtime_resolve, link_map">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="_dl_runtime_resolve Research">
<meta property="og:description" content="Dying in the sun">
<meta property="og:url" content="/_dl_runtime_resolve-research/">
<meta property="og:site_name" content="Ever R In The Sun">





<link rel="canonical" href="/_dl_runtime_resolve-research/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ever R In The Sun Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="neoni photo" class="author-photo">
					<h4>neoni</h4>
					<p>優しくなりたければ強くあれ</p>
				</li>
				<!--li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li-->
				<li>
					<a href="mailto:chaos.dec@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				
				<li>
					<a href="http://github.com/neoni"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/_dl_runtime_resolve-research/" rel="bookmark" title="_dl_runtime_resolve Research">_dl_runtime_resolve Research</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-09-10T19:34:05+08:00">September 10, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~9 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <h2>调试相关</h2>

<p>安装libc debug symbol.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">sudo apt-get install libc-dbg
</code></pre></div>
<p>安装libc6 source</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">sudo apt-get install build-essential
sudo apt-get <span class="nb">source </span>libc6
</code></pre></div>
<p>gdb 中添加符号文件，源码</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">info</span> <span class="n">sharedlibrary</span>
<span class="n">From</span>                <span class="n">To</span>                  <span class="n">Syms</span> <span class="n">Read</span>   <span class="n">Shared</span> <span class="n">Object</span> <span class="n">Library</span>
<span class="mh">0x00007fe2880e1ae0</span>  <span class="mh">0x00007fe2880fa170</span>  <span class="n">Yes</span>         <span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mf">64.</span><span class="n">so</span><span class="o">.</span><span class="mi">2</span>
                                        <span class="n">No</span>          <span class="n">linux</span><span class="o">-</span><span class="n">vdso</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">1</span>
<span class="mh">0x00007fe287d574a0</span>  <span class="mh">0x00007fe287e816d3</span>  <span class="n">Yes</span>         <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">6</span>

<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">add</span><span class="o">-</span><span class="n">symbol</span><span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="mf">2.19</span><span class="o">.</span><span class="n">so</span> <span class="mh">0x00007fe2880e1ae0</span>
<span class="n">add</span> <span class="n">symbol</span> <span class="n">table</span> <span class="kn">from</span> <span class="nn">file</span> <span class="s">&quot;/usr/lib/debug/lib/x86_64-linux-gnu/ld-2.19.so&quot;</span> <span class="n">at</span>
    <span class="o">.</span><span class="n">text_addr</span> <span class="o">=</span> <span class="mh">0x7fe2880e1ae0</span>
<span class="n">Reading</span> <span class="n">symbols</span> <span class="kn">from</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="mf">2.19</span><span class="o">.</span><span class="n">so</span><span class="o">...</span><span class="n">done</span><span class="o">.</span>

<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">directory</span> <span class="o">~/</span><span class="n">glibc</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.19</span><span class="o">/</span><span class="n">elf</span><span class="o">/</span>
<span class="n">Source</span> <span class="n">directories</span> <span class="n">searched</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">neoni</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.19</span><span class="o">/</span><span class="n">elf</span><span class="p">:</span><span class="err">$</span><span class="n">cdir</span><span class="p">:</span><span class="err">$</span><span class="n">cwd</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="nb">set</span> <span class="n">disassemble</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">line</span> <span class="n">on</span>
</code></pre></div>
<hr>

<h2>PLT 到 _dl_runtime_resolve</h2>

<p>在第一次调用时，xxx@got.plt会跳回xxx@plt。接下来，会将参数push到栈上并跳至.got.plt+0x8。压入reloc_offset 和 link_map。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">disas</span> <span class="n">some_func</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">some_func</span><span class="p">:</span>
<span class="mh">0x804</span><span class="n">xxx4</span> <span class="o">&lt;</span><span class="n">some_func</span><span class="o">&gt;</span><span class="p">:</span>     <span class="n">jmp</span>    <span class="o">*</span><span class="n">some_func_dyn_reloc_entry</span>
<span class="mh">0x804</span><span class="n">xxxa</span> <span class="o">&lt;</span><span class="n">some_func</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">push</span>   <span class="err">$</span><span class="n">reloc_offset</span>
<span class="mh">0x804</span><span class="n">xxxf</span> <span class="o">&lt;</span><span class="n">some_func</span><span class="o">+</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">jmp</span>    <span class="n">beginning_of_</span><span class="o">.</span><span class="n">plt_section</span>
</code></pre></div>
<p>然后调用_dl_runtime_resolve</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">_dl_runtime_resolve</span><span class="p">(</span><span class="n">link_map</span><span class="p">,</span> <span class="n">rel_offset</span><span class="p">);</span>
</code></pre></div>
<p>_dl_runtime_resolve则会完成具体的符号解析，填充结果，和调用的工作。</p>

<p>其中_dl_runtime_resolve调用了_dl_fixup， _dl_fixup返回函数地址，然后跳转到该地址上</p>
<div class="highlight"><pre><code class="language-asm" data-lang="asm"><span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x7fdd1d9032f0</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x38</span>
   <span class="err">0</span><span class="nf">x7fdd1d9032f4</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">]</span><span class="p">,</span><span class="no">rax</span>
   <span class="err">0</span><span class="nf">x7fdd1d9032f8</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x8</span><span class="err">]</span><span class="p">,</span><span class="no">rcx</span>
   <span class="err">0</span><span class="nf">x7fdd1d9032fd</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">13</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="err">]</span><span class="p">,</span><span class="no">rdx</span>
   <span class="err">0</span><span class="nf">x7fdd1d903302</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">18</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x18</span><span class="err">]</span><span class="p">,</span><span class="no">rsi</span>
   <span class="err">0</span><span class="nf">x7fdd1d903307</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x20</span><span class="err">]</span><span class="p">,</span><span class="no">rdi</span>
   <span class="err">0</span><span class="nf">x7fdd1d90330c</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x28</span><span class="err">]</span><span class="p">,</span><span class="no">r8</span>
   <span class="err">0</span><span class="nf">x7fdd1d903311</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x30</span><span class="err">]</span><span class="p">,</span><span class="no">r9</span>
   <span class="err">0</span><span class="nf">x7fdd1d903316</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">38</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x40</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d90331b</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x38</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d903320</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">call</span>   <span class="mh">0x7fdd1d8fcd10</span> <span class="p">&lt;</span><span class="no">_dl_fixup</span><span class="p">&gt;</span>
   <span class="err">0</span><span class="nf">x7fdd1d903325</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">r11</span><span class="p">,</span><span class="no">rax</span>
   <span class="err">0</span><span class="nf">x7fdd1d903328</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">r9</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x30</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d90332d</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">61</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">r8</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x28</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d903332</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">66</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x20</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d903337</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x18</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d90333c</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">76</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d903341</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">81</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rcx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x8</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d903346</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="err">[</span><span class="no">rsp</span><span class="err">]</span>
   <span class="err">0</span><span class="nf">x7fdd1d90334a</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">add</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x48</span>
   <span class="err">0</span><span class="nf">x7fdd1d90334e</span> <span class="err">&lt;</span><span class="no">_dl_runtime_resolve</span><span class="err">+</span><span class="mi">94</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">jmp</span>    <span class="no">r11</span>
</code></pre></div>
<hr>

<h2>_dl_fixup</h2>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">_dl_fixup</span><span class="p">(</span><span class="n">link_map</span><span class="p">,</span> <span class="n">rel_offset</span><span class="p">);</span>
</code></pre></div>
<h4>.dynamic中的一些重要元素</h4>

<ul>
<li><p>DT_STRTAB</p>

<p>该元素保存着字符串表地址，包括了符号名，库名，和一些其他的在该表中的字符串。</p></li>
<li><p>DT_SYMTAB</p>

<p>该元素保存着符号表的地址。</p></li>
<li><p>DT_JMPREL</p>

<p>假如存在，它的入口d_ptr 成员保存着重定位入口（该入口单独关联着PLT）的地址。假如lazy方式打开，那么分离它们的重定位入口让动态连接器在进程初始化时忽略它们。假如该入口存在，相关联的类型入口DT_PLTRELSZ和DT_PLTREL一定要存在。</p></li>
<li><p>VERSYM</p>

<p>该元素保存着版本表的地址。     </p></li>
</ul>

<p>下面以 <code>puts@plt</code> 为例，探寻其 _dl_runtime_resolve 过程</p>

<p>首先得到其 .dynamic 的 信息</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="err">$</span> <span class="n">readelf</span> <span class="o">-</span><span class="n">d</span> <span class="n">xxx</span>

<span class="n">Dynamic</span> <span class="n">section</span> <span class="n">at</span> <span class="n">offset</span> <span class="mh">0xe50</span> <span class="n">contains</span> <span class="mi">20</span> <span class="n">entries</span><span class="p">:</span>
  <span class="n">Tag</span>        <span class="n">Type</span>                         <span class="n">Name</span><span class="o">/</span><span class="n">Value</span>
 <span class="mh">0x0000000000000001</span> <span class="p">(</span><span class="n">NEEDED</span><span class="p">)</span>             <span class="n">Shared</span> <span class="n">library</span><span class="p">:</span> <span class="p">[</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">6</span><span class="p">]</span>
 <span class="mh">0x000000000000000c</span> <span class="p">(</span><span class="n">INIT</span><span class="p">)</span>               <span class="mh">0x400400</span>
 <span class="mh">0x000000000000000d</span> <span class="p">(</span><span class="n">FINI</span><span class="p">)</span>               <span class="mh">0x400668</span>
 <span class="mh">0x000000006ffffef5</span> <span class="p">(</span><span class="n">GNU_HASH</span><span class="p">)</span>           <span class="mh">0x400298</span>
 <span class="mh">0x0000000000000005</span> <span class="p">(</span><span class="n">STRTAB</span><span class="p">)</span>             <span class="mh">0x400330</span>
 <span class="mh">0x0000000000000006</span> <span class="p">(</span><span class="n">SYMTAB</span><span class="p">)</span>             <span class="mh">0x4002b8</span>
 <span class="mh">0x000000000000000a</span> <span class="p">(</span><span class="n">STRSZ</span><span class="p">)</span>              <span class="mi">66</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
 <span class="mh">0x000000000000000b</span> <span class="p">(</span><span class="n">SYMENT</span><span class="p">)</span>             <span class="mi">24</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
 <span class="mh">0x0000000000000015</span> <span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span>              <span class="mh">0x0</span>
 <span class="mh">0x0000000000000003</span> <span class="p">(</span><span class="n">PLTGOT</span><span class="p">)</span>             <span class="mh">0x600fe8</span>
 <span class="mh">0x0000000000000002</span> <span class="p">(</span><span class="n">PLTRELSZ</span><span class="p">)</span>           <span class="mi">72</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
 <span class="mh">0x0000000000000014</span> <span class="p">(</span><span class="n">PLTREL</span><span class="p">)</span>             <span class="n">RELA</span>
 <span class="mh">0x0000000000000017</span> <span class="p">(</span><span class="n">JMPREL</span><span class="p">)</span>             <span class="mh">0x4003b8</span>
 <span class="mh">0x0000000000000007</span> <span class="p">(</span><span class="n">RELA</span><span class="p">)</span>               <span class="mh">0x4003a0</span>
 <span class="mh">0x0000000000000008</span> <span class="p">(</span><span class="n">RELASZ</span><span class="p">)</span>             <span class="mi">24</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
 <span class="mh">0x0000000000000009</span> <span class="p">(</span><span class="n">RELAENT</span><span class="p">)</span>            <span class="mi">24</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
 <span class="mh">0x000000006ffffffe</span> <span class="p">(</span><span class="n">VERNEED</span><span class="p">)</span>            <span class="mh">0x400380</span>
 <span class="mh">0x000000006fffffff</span> <span class="p">(</span><span class="n">VERNEEDNUM</span><span class="p">)</span>         <span class="mi">1</span>
 <span class="mh">0x000000006ffffff0</span> <span class="p">(</span><span class="n">VERSYM</span><span class="p">)</span>             <span class="mh">0x400372</span>
 <span class="mh">0x0000000000000000</span> <span class="p">(</span><span class="n">NULL</span><span class="p">)</span>               <span class="mh">0x0</span>
</code></pre></div>
<h4>_dl_fixup 的工作</h4>

<p>下面关于 _dl_fixup 的介绍省略了一些细节，介绍了一些与 .dynamic 相关的主要工作</p>

<p>1) 计算 reloc entry</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">const</span> <span class="n">PLTREL</span> <span class="o">*</span><span class="k">const</span> <span class="n">reloc</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">D_PTR</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l_info</span><span class="p">[</span><span class="n">DT_JMPREL</span><span class="p">])</span> <span class="o">+</span> <span class="n">reloc_offset</span><span class="p">);</span>
</code></pre></div>
<p>根据 DT_JMPREL 找到偏移值， JMPREL segment 对应于.rel.plt section，是用来保存运行时重定位表的。它与.rel.dyn类似，只不过.rel.plt是用于函数重定位，.rel.dyn是用于变量重定位。具体地，其内容如下:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">readelf</span> <span class="o">-</span><span class="n">r</span> <span class="n">xxx</span>

<span class="n">Relocation</span> <span class="n">section</span> <span class="s">&#39;.rela.dyn&#39;</span> <span class="n">at</span> <span class="n">offset</span> <span class="mh">0x3a0</span> <span class="n">contains</span> <span class="mi">1</span> <span class="n">entries</span><span class="p">:</span>
  <span class="n">Offset</span>          <span class="n">Info</span>           <span class="n">Type</span>           <span class="n">Sym</span><span class="o">.</span> <span class="n">Value</span>    <span class="n">Sym</span><span class="o">.</span> <span class="n">Name</span> <span class="o">+</span> <span class="n">Addend</span>
<span class="mo">000000600</span><span class="n">fe0</span>  <span class="mo">000400000006</span> <span class="n">R_X86_64_GLOB_DAT</span> <span class="mo">0000000000000000</span> <span class="n">__gmon_start__</span> <span class="o">+</span> <span class="mi">0</span>

<span class="n">Relocation</span> <span class="n">section</span> <span class="s">&#39;.rela.plt&#39;</span> <span class="n">at</span> <span class="n">offset</span> <span class="mh">0x3b8</span> <span class="n">contains</span> <span class="mi">3</span> <span class="n">entries</span><span class="p">:</span>
  <span class="n">Offset</span>          <span class="n">Info</span>           <span class="n">Type</span>           <span class="n">Sym</span><span class="o">.</span> <span class="n">Value</span>    <span class="n">Sym</span><span class="o">.</span> <span class="n">Name</span> <span class="o">+</span> <span class="n">Addend</span>
<span class="mo">000000601000</span>  <span class="mo">000100000007</span> <span class="n">R_X86_64_JUMP_SLO</span> <span class="mo">0000000000000000</span> <span class="n">puts</span> <span class="o">+</span> <span class="mi">0</span>
<span class="mo">00000060100</span><span class="mi">8</span>  <span class="mo">000200000007</span> <span class="n">R_X86_64_JUMP_SLO</span> <span class="mo">0000000000000000</span> <span class="n">read</span> <span class="o">+</span> <span class="mi">0</span>
<span class="mo">000000601010</span>  <span class="mo">000300000007</span> <span class="n">R_X86_64_JUMP_SLO</span> <span class="mo">0000000000000000</span> <span class="n">__libc_start_main</span> <span class="o">+</span> <span class="mi">0</span>
</code></pre></div>
<p>这些条目的类型是</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="n">Elf32_Addr</span>    <span class="n">r_offset</span><span class="p">;</span>       <span class="cm">/* Address */</span>
  <span class="n">Elf32_Word</span>    <span class="n">r_info</span><span class="p">;</span>         <span class="cm">/* Relocation type and symbol index */</span>
<span class="p">}</span> <span class="n">Elf32_Rel</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="n">Elf64_Addr</span>    <span class="n">r_offset</span><span class="p">;</span>       <span class="cm">/* Address */</span>
  <span class="n">Elf64_Xword</span>   <span class="n">r_info</span><span class="p">;</span>         <span class="cm">/* Relocation type and symbol index */</span>
<span class="p">}</span> <span class="n">Elf64_Rel</span><span class="p">;</span>
</code></pre></div>
<p>在 gdb 中查看jmprel中的内容，可以看到与 readelf -r 的内容一样</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="n">xg</span> <span class="mh">0x4003b8</span>
<span class="mh">0x4003b8</span><span class="p">:</span>   <span class="mh">0x0000000000601000</span>  <span class="mh">0x0000000100000007</span>
<span class="mh">0x4003c8</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000601008</span>
<span class="mh">0x4003d8</span><span class="p">:</span>   <span class="mh">0x0000000200000007</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x4003e8</span><span class="p">:</span>   <span class="mh">0x0000000000601010</span>  <span class="mh">0x0000000300000007</span>
</code></pre></div>
<p>加上对应的 reloc_offset，就可以找到函数的重定位入口 reloc</p>

<p>其中 puts@plt 的 reloc_offset 为0，所以 reloc =  0x4003b8 + 0 = 0x4003b8, 其中 <code>r_offset</code> 为 0x0000000000601000， 即 <code>puts@got.plt</code> 的地址，<code>r_info</code> 为0x0000000100000007， <code>r_info</code> 保存的是其类型和符号序号。根据宏的定义，对于此条目，其类型为<code>ELF64_R_TYPE(r_info)=7</code>，对应于 <code>R_X86_64_JUMP_SLOT</code>；其symbol index则为 <code>RLF64_R_SYM(r_info)=1</code>。</p>

<p>2) 计算函数的 symtab entry</p>

<p>每一条symbol信息的大小在SYMENT中体现，可以在 readelf -d 中看到为 24 bytes。</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">const</span> <span class="n">ElfW</span><span class="p">(</span><span class="n">Sym</span><span class="p">)</span> <span class="o">*</span><span class="n">sym</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">symtab</span><span class="p">[</span><span class="n">ELFW</span><span class="p">(</span><span class="n">R_SYM</span><span class="p">)</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">r_info</span><span class="p">)];</span>
</code></pre></div>
<p>所以 sym = SYMTAB + 1*24 </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="n">xw</span> <span class="mh">0x4002b8</span><span class="o">+</span><span class="mi">24</span>
<span class="mh">0x4002d0</span><span class="p">:</span>   <span class="mh">0x0000001a</span>  <span class="mh">0x00000012</span>  <span class="mh">0x00000000</span>  <span class="mh">0x00000000</span>
<span class="mh">0x4002e0</span><span class="p">:</span>   <span class="mh">0x00000000</span>  <span class="mh">0x00000000</span>  <span class="mh">0x0000001f</span>  <span class="mh">0x00000012</span>
<span class="mh">0x4002f0</span><span class="p">:</span>   <span class="mh">0x00000000</span>  <span class="mh">0x00000000</span>
</code></pre></div>
<p>其中 sym 的 结构为：</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="n">Elf32_Word</span>    <span class="n">st_name</span><span class="p">;</span>        <span class="cm">/* Symbol name (string tbl index) */</span>
  <span class="n">Elf32_Addr</span>    <span class="n">st_value</span><span class="p">;</span>       <span class="cm">/* Symbol value */</span>
  <span class="n">Elf32_Word</span>    <span class="n">st_size</span><span class="p">;</span>        <span class="cm">/* Symbol size */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">st_info</span><span class="p">;</span>        <span class="cm">/* Symbol type and binding */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">st_other</span><span class="p">;</span>       <span class="cm">/* Symbol visibility */</span>
  <span class="n">Elf32_Section</span> <span class="n">st_shndx</span><span class="p">;</span>       <span class="cm">/* Section index */</span>
<span class="p">}</span> <span class="n">Elf32_Sym</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="n">Elf64_Word</span>    <span class="n">st_name</span><span class="p">;</span>        <span class="cm">/* Symbol name (string tbl index) */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">st_info</span><span class="p">;</span>        <span class="cm">/* Symbol type and binding */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">st_other</span><span class="p">;</span>       <span class="cm">/* Symbol visibility */</span>
  <span class="n">Elf64_Section</span> <span class="n">st_shndx</span><span class="p">;</span>       <span class="cm">/* Section index */</span>
  <span class="n">Elf64_Addr</span>    <span class="n">st_value</span><span class="p">;</span>       <span class="cm">/* Symbol value */</span>
  <span class="n">Elf64_Xword</span>   <span class="n">st_size</span><span class="p">;</span>        <span class="cm">/* Symbol size */</span>
<span class="p">}</span> <span class="n">Elf64_Sym</span><span class="p">;</span>
</code></pre></div>
<p>3) sanity check </p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">assert</span> <span class="p">(</span><span class="n">ELFW</span><span class="p">(</span><span class="n">R_TYPE</span><span class="p">)(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">r_info</span><span class="p">)</span> <span class="o">==</span> <span class="n">ELF_MACHINE_JMP_SLOT</span><span class="p">);</span>

<span class="cp">#define ELF_MACHINE_JMP_SLOT    R_X86_64_JUMP_SLOT</span>
</code></pre></div>
<p>4) 如果 <code>sym-&gt;st_other &amp; 3 != 0</code>, 已经被 resolve 过了, 跳到 7，否则继续</p>

<p>5) 如果版本信息被激活，那么需要找到对应的版本信息 </p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">uint16_t</span> <span class="n">ndx</span> <span class="o">=</span> <span class="n">VERSYM</span><span class="p">[</span> <span class="n">ELF64_R_SYM</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">r_info</span><span class="p">)</span> <span class="p">];</span> 

<span class="k">const</span> <span class="k">struct</span> <span class="n">r_found_version</span> <span class="o">*</span><span class="n">version</span> <span class="o">=&amp;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">l_versions</span><span class="p">[</span><span class="n">ndx</span><span class="p">];</span>
</code></pre></div>
<p>6) 找函数库:</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">result</span> <span class="o">=</span> <span class="n">_dl_lookup_symbol_x</span> <span class="p">(</span><span class="n">strtab</span> <span class="o">+</span> <span class="n">sym</span><span class="o">-&gt;</span><span class="n">st_name</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sym</span><span class="p">,</span> <span class="n">l</span><span class="o">-&gt;</span><span class="n">l_scope</span><span class="p">,</span>
                    <span class="n">version</span><span class="p">,</span> <span class="n">ELF_RTYPE_CLASS_PLT</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<p><code>strtab + sym-&gt;st_name</code> 为函数库名称</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="n">s</span> <span class="mh">0x400330</span><span class="o">+</span><span class="mh">0x0000001a</span>
<span class="mh">0x40034a</span><span class="p">:</span>   <span class="s">&quot;puts&quot;</span>
<span class="mh">0x40034f</span><span class="p">:</span>   <span class="s">&quot;read&quot;</span>
<span class="mh">0x400354</span><span class="p">:</span>   <span class="s">&quot;__libc_start_ma&quot;</span><span class="o">...</span>
<span class="mh">0x400363</span><span class="p">:</span>   <span class="s">&quot;in&quot;</span>
</code></pre></div>
<p><code>_dl_lookup_symbol_x</code> 将返回 以libc为当前节点的link_map结构，并查找填充了sym 的信息</p>

<p>7) 添加函数偏移，找到了函数地址</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">value</span> <span class="o">=</span> <span class="n">DL_FIXUP_MAKE_VALUE</span> <span class="p">(</span><span class="n">result</span>
                   <span class="n">sym</span> <span class="o">?</span> <span class="p">(</span><span class="n">LOOKUP_VALUE_ADDRESS</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">sym</span><span class="o">-&gt;</span><span class="n">st_value</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p>8) 最后找到地址后，填充至.got.plt对应位置，调整栈，调用这一解析得到的函数。</p>

<hr>

<h2>总结</h2>

<ul>
<li><p><code>_dl_runtime_resolve</code> 调用 <code>_dl_fixup</code> 来完成符号解析。</p></li>
<li><p>首先通过 <code>.dynamic</code> 中的 <code>DT_JMPREL</code> 与参数 <code>reloc_offset</code> 的值找到重定位结构 <code>Elf64_Rel</code>，然后根据<code>Elf64_Rel-&gt;r_offset</code> 在 <code>DT_SYMTAB</code> 找到符号结构 Elf64_Sym。</p></li>
<li><p>并根据<code>Elf64_Rel-&gt;r_info</code> 与 <code>Elf64_Sym-&gt;st_other</code> 校验。</p></li>
<li><p>如果 <code>DT_VERSYM</code>存在，根据其查找版本信息。在 <code>DT_STRTAB</code> 根据 <code>Elf64_Sym-&gt;st_name</code> 找到函数库名称。</p></li>
<li><p>调用 <code>_dl_lookup_symbol_x</code>根据函数库名，符号结构，版本信息等搜索函数库以及符号信息，得到函数库基地址与完整的符号信息结构（包含函数在函数库中的偏移）。</p></li>
<li><p>基地址与函数偏移相加顺利得到函数地址，填充至.got.plt对应位置，调整栈，调用这一解析得到的函数。</p></li>
</ul>

<hr>

<h2>参考</h2>

<p>程序员的自我修养</p>

<p><a href="http://phrack.org/issues/58/4.html#article">http://phrack.org/issues/58/4.html#article</a></p>

<p><a href="http://docs.oracle.com/cd/E23824_01/html/819-0690/chapter6-42444.html#scrolltoc">Dynamic Section</a></p>

<p><a href="http://rk700.github.io/article/2015/08/09/return-to-dl-resolve/">ROP之return to dl-resolve</a></p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#exploit" title="Pages tagged exploit" class="tag"><span class="term">exploit</span></a><a href="/tags/#_dl_runtime_resolve" title="Pages tagged _dl_runtime_resolve" class="tag"><span class="term">_dl_runtime_resolve</span></a><a href="/tags/#link_map" title="Pages tagged link_map" class="tag"><span class="term">link_map</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/_dl_runtime_resolve-research/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/_dl_runtime_resolve-research/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/_dl_runtime_resolve-research/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/got-plt-research/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/got-plt-research/" title=".got.plt Research">.got.plt Research</a></h3>
      <p>.got.plt的前3项，分别是.dynamic的地址，link_map 的地址和 _dl_runtime_resolve 的地址由此可以得到很多有用的信息.dynamic.dynamic 保存了动态链接器所需要的基本信息，比如依赖哪些共享对象、动态链接符号表的位置、动态链...&hellip; <a href="/got-plt-research/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/debugging-forks/" title="Debugging Forks">Debugging Forks</a></h4>
        <span>Published on September 08, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/ptrace-with-suid-program/" title="Suid program can't work with ptrace">Suid program can't work with ptrace</a></h4>
        <span>Published on September 05, 2015</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 neoni. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66923481-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'neoni'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
